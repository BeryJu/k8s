apiVersion: ricoberger.de/v1alpha1
kind: VaultSecret
metadata:
  name: beryjuorg-mimir
  namespace: mimir
spec:
  path: kv/services/thanos
  type: Opaque
  templates:
    config.yaml: |
      # Do not use this configuration in production.
      # It is for demonstration purposes only.
      multitenancy_enabled: false
      target: all,alertmanager,overrides-exporter

      blocks_storage:
        backend: s3
        s3:
          endpoint: minio-prd.minio.svc.cluster.local:9000
          insecure: true
          bucket_name: mimir
          access_key_id: "{% .Secrets.access_key %}"
          secret_access_key: "{% .Secrets.secret_key %}"
        tsdb:
          dir: /data/tsdb

      compactor:
        data_dir: /data/compactor
        sharding_ring:
          kvstore:
            store: memberlist

      distributor:
        ring:
          instance_addr: 127.0.0.1
          kvstore:
            store: memberlist

      ingester:
        ring:
          instance_addr: 127.0.0.1
          kvstore:
            store: memberlist
          replication_factor: 1

      ruler_storage:
        backend: s3
        s3:
          endpoint: minio-prd.minio.svc.cluster.local:9000
          insecure: true
          bucket_name: mimir-ruler
          access_key_id: "{% .Secrets.access_key %}"
          secret_access_key: "{% .Secrets.secret_key %}"

      ruler:
        rule_path: /data/ruler
        alertmanager_url: http://127.0.0.1:8080/alertmanager
        ring:
          # Quickly detect unhealthy rulers to speed up the tutorial.
          heartbeat_period: 2s
          heartbeat_timeout: 10s

      server:
        log_level: info

      store_gateway:
        sharding_ring:
          replication_factor: 1

      limits:
        max_label_names_per_series: 100
        max_global_series_per_user: 1500000
        max_global_series_per_metric: 200000
        ingestion_rate: 100000
