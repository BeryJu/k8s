apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: registry-general
  namespace: registry
spec:
  secretStoreRef:
    name: vault-kv
    kind: ClusterSecretStore
  target:
    template:
      data:
        REGISTRY_STORAGE: "s3"
        REGISTRY_STORAGE_S3_REGIONENDPOINT: https://s3.beryju.org
        REGISTRY_STORAGE_S3_REGION: "us-east-1"
        REGISTRY_HTTP_DEBUG_ADDR: "0.0.0.0:5001"
        REGISTRY_HTTP_DEBUG_PROMETHEUS_ENABLED: "true"
        REGISTRY_STORAGE_REDIRECT_DISABLE: "true"
        REGISTRY_LOG_ACCESSLOG_DISABLED: "false"
        REGISTRY_LOG_FORMATTER: "json"
  data:
    - secretKey: REGISTRY_HTTP_SECRET
      remoteRef:
        key: kv/services/minio/main
        property: oidc_secret
    - secretKey: REGISTRY_STORAGE_S3_ACCESSKEY
      remoteRef:
        key: kv/services/minio/main
        property: username
    - secretKey: REGISTRY_STORAGE_S3_SECRETKEY
      remoteRef:
        key: kv/services/minio/main
        property: password
