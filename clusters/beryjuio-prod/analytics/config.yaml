apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: beryjuorg-plausible-config
  namespace: analytics
spec:
  secretStoreRef:
    name: vault-kv
    kind: ClusterSecretStore
  target:
    template:
      data:
        BASE_URL: https://analytics.beryju.org
        DISABLE_REGISTRATION: "true"
        MAILER_EMAIL: plausible@services.beryju.org
        SMTP_HOST_ADDR: email-smtp.eu-central-1.amazonaws.com
        SMTP_HOST_PORT: "587"
        DATABASE_URL: postgres://postgres:{% .postgres_pwd %}@plausible-db:5432/plausible_db
        CLICKHOUSE_DATABASE_URL: http://plausible-events-db:8123/plausible_events_db
  data:
    - secretKey: SECRET_KEY_BASE
      remoteRef:
        key: kv/services/plausible
        property: secret_key
    - secretKey: SMTP_USER_NAME
      remoteRef:
        key: kv/services/plausible
        property: email_user
    - secretKey: SMTP_USER_PWD
      remoteRef:
        key: kv/services/plausible
        property: email_pwd
    - secretKey: postgres_pwd
      remoteRef:
        key: kv/services/plausible
        property: postgres_pwd
