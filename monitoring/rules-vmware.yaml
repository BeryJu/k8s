apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: beryjuorg-prometheus-vmware
  namespace: monitoring-system
spec:
  groups:
    - name: beryjuorg-prometheus-vmware
      rules:
        - alert: VirtualMachineMemoryWarning
          expr: vmware_vm_mem_usage_average / 100 >= 80 and vmware_vm_mem_usage_average / 100 < 90
          for: 5m
          labels:
            severity: warning
          annotations:
            summary: Virtual Machine Memory Warning (instance {{ $labels.instance }})
            description: "High memory usage on {{ $labels.instance }}: {{ $value | printf \"%.2f\"}}%\n  VALUE = {{ $value }}\n  LABELS = {{ $labels }}"

        - alert: VirtualMachineMemoryCritical
          expr: vmware_vm_mem_usage_average / 100 >= 90
          for: 1m
          labels:
            severity: critical
          annotations:
            summary: Virtual Machine Memory Critical (instance {{ $labels.instance }})
            description: "High memory usage on {{ $labels.instance }}: {{ $value | printf \"%.2f\"}}%\n  VALUE = {{ $value }}\n  LABELS = {{ $labels }}"

        - alert: HighNumberOfSnapshots
          expr: vmware_vm_snapshots > 3
          for: 30m
          labels:
            severity: warning
          annotations:
            summary: High Number of Snapshots (instance {{ $labels.instance }})
            description: "High snapshots number on {{ $labels.instance }}: {{ $value }}\n  VALUE = {{ $value }}\n  LABELS = {{ $labels }}"

        - alert: OutdatedSnapshots
          expr: (time() - vmware_vm_snapshot_timestamp_seconds) / (60 * 60 * 24) >= 3
          for: 5m
          labels:
            severity: warning
          annotations:
            summary: Outdated Snapshots (instance {{ $labels.instance }})
            description: "Outdated snapshots on {{ $labels.instance }}: {{ $value | printf \"%.0f\"}} days\n  VALUE = {{ $value }}\n  LABELS = {{ $labels }}"
